$(function(){function n(t){for(var n=window.location.search.substring(1).split("&"),o=0;o<n.length;o++){var e=n[o].split("=");if(e[0]==t)return e[1]}return!1}var o="http://www.zpffz.com",e=$("#msg-puop")[0],r=$(".get-code"),i=$("#phone-number")[0],s=$("#vef-code")[0],t=$(".btn-sbumit"),c=$(".modal"),a=$(".modal").find(".close"),u=$("#confirm"),f={X:0,y:0};function h(){this.checkInfo=[],this.wran=[]}h.prototype.strategies={noEmpty:function(t,n){return""!==t||n},isMobile:function(t,n){return!!/^1[3456789]\d{9}$/.test(t)||n}},h.prototype.add=function(r,i,t){var s=this;this.wran.push(i),t.forEach(function(e){s.checkInfo.push(function(){var t=e.strategy.split(":"),n=t.shift();t.unshift(r.value),t.push(e.error);var o=s.strategies[n].apply(s,t);return console.log("msg",o),!0!==o&&p.show(i,o),o})})};var l={isNot:!(h.prototype.check=function(){var t=!0;this.wran.forEach(function(t){t.innerText=""});for(var n=0;n<this.checkInfo.length;n++)if(!0!==this.checkInfo[n]())return t=!1;return t}),countTimer:0,countDown:function(t){this.isNot=!0,this.countTimer=setInterval(function(){--t<=0?this.clearCountTimer():r.text("重新获取("+t+")s")},1e3)},clearCountTimer:function(){this.isNot=!1,clearInterval(this.countTimer),r.text("获取验证码")}},p={timer:0,show:function(t,n){$(t).text(n).fadeIn(200),this.hide(t,"")},hide:function(t,n){this.timer&&clearInterval(this.timer),this.timer=setInterval(function(){$(t).fadeOut(200,function(){$(this).text(n)})},3e3)}};r.on("click",function(){var t;l.isNot||(t={mobile:i.value,originUrl:n("originUrl")},$.ajax({type:"post",url:o+"/api/dq/bjph/sendCode",data:t}).done(function(t){console.log("res",t),200===t.code?(l.countDown(60),f=t.data,p.show(e,"验证码已下发")):p.show(e,t.msg)}).fail(function(t){var n=JSON.parse(t.responseText);console.log("err",n),p.show(e,n.msg)}))});var d=new h;t.click(function(){d.add(i,e,[{strategy:"noEmpty",error:"请输入手机号"},{strategy:"isMobile",error:"手机号码有误，请重新输入"}]),d.add(s,e,[{strategy:"noEmpty",error:"请输入验证码"}]),d.check()&&c.fadeIn(300,function(){$("#x").text((f.X||"x")+"元"),$("#y").text((f.Y||"y")+"元")})}),u.on("click",function(){var t={mobile:i.value,validCode:s.value,originUrl:n("originUrl")};c.fadeOut(300),$.ajax({type:"post",url:o+"/api/dq/bjph/saveOrders",data:t,success:function(t){console.log("res",t);var n=200===t.code?"订购成功！会员权益请在北京移动APP内领取":t.msg;p.show(e,n)},error:function(t){var n=JSON.parse(t.responseText);p.show(e,n.msg)}})}),a.on("click",function(){c.fadeOut(300)})});